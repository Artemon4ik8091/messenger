# Документация Клиента Мессенджера (PyQt6)

Эта документация описывает настройку, установку и использование клиентского приложения мессенджера, разработанного на PyQt6.

---

## 1. Введение

Этот проект представляет собой настольное клиентское приложение для мессенджера, разработанное с использованием библиотеки PyQt6 для создания графического пользовательского интерфейса и библиотеки `requests` для взаимодействия с RESTful API backend'а. Клиент позволяет пользователям регистрироваться, входить в систему, создавать различные типы чатов (приватные, групповые, каналы), отправлять и получать текстовые сообщения и файлы.

## 2. Требования

Для запуска проекта вам потребуется:

* **Python 3.8+**
* **pip** (менеджер пакетов Python)

## 3. Настройка проекта

Следуйте этим шагам для настройки и подготовки проекта к запуску.

### Установка зависимостей

После активации виртуального окружения установите необходимые пакеты. В данном проекте используются следующие библиотеки:

```bash
pip install PyQt6 requests
```

  * `PyQt6`: Набор привязок Python для фреймворка Qt, используемый для создания графического интерфейса.
  * `requests`: Библиотека для выполнения HTTP-запросов к API backend'а.

## 4\. Запуск клиента

После настройки и установки зависимостей вы можете запустить клиентское приложение:

Убедитесь, что ваше виртуальное окружение активировано.

```bash
python main.py
```

## 5\. Использование клиента

При запуске приложения вы увидите диалоговое окно входа/регистрации.

### Настройки подключения

Перед входом или регистрацией, убедитесь, что вы настроили подключение к backend серверу. В диалоге входа есть кнопка "Настройки сервера". Нажмите её и введите:

  * **Адрес сервера:** IP-адрес или доменное имя вашего backend сервера (например, `127.0.0.1` или `localhost`).
  * **Порт сервера:** Порт, на котором запущен ваш backend сервер (по умолчанию `5125`).

Нажмите "Сохранить", чтобы применить настройки. Эти настройки сохраняются локально.

### Регистрация

Если у вас нет учетной записи:

1.  Нажмите кнопку "Зарегистрироваться" в диалоговом окне входа.
2.  Заполните поля "Имя пользователя", "Пароль" и "Отображаемое имя".
3.  Нажмите "Зарегистрироваться".
4.  В случае успеха, вы будете перенаправлены на экран входа.

### Вход в систему

1.  Введите ваше "Имя пользователя" и "Пароль" в соответствующие поля.
2.  Нажмите кнопку "Войти".
3.  В случае успешного входа, откроется главное окно мессенджера.

### Основной интерфейс

После входа в систему вы увидите главное окно, состоящее из нескольких областей:

  * **Список чатов (слева):** Отображает все чаты, в которых вы участвуете. При нажатии на чат, загружаются его сообщения.
  * **Область сообщений (центр):** Отображает историю сообщений выбранного чата.
  * **Поле ввода сообщения (внизу):** Для ввода текстовых сообщений.
  * **Кнопки отправки (внизу):** Для отправки текстового сообщения или файла.
  * **Кнопки управления чатами (сверху):** Для создания новых чатов.
  * **Кнопка профиля (сверху):** Для выхода из системы или обновления профиля.

### Создание чатов

Нажмите кнопку "Создать чат" для выбора типа чата:

  * **Приватный чат:** Откроется диалог, где вы сможете ввести имя пользователя, с которым хотите начать приватный чат.
  * **Групповой чат:** Откроется диалог, где вы сможете ввести название группы.
  * **Канал:** Откроется диалог, где вы сможете ввести название канала.

После создания чат появится в вашем списке чатов.

### Отправка сообщений и файлов

1.  **Выбор чата:** Нажмите на чат в списке слева, чтобы открыть его.
2.  **Отправка текстового сообщения:** Введите текст в поле ввода сообщения и нажмите кнопку "Отправить".
3.  **Отправка файла:** Нажмите кнопку "Отправить файл". Откроется диалоговое окно выбора файла. Выберите файл, и он будет загружен в чат.

### Управление чатами (Контекстное меню)

Для чатов в списке чатов доступно контекстное меню (правая кнопка мыши):

  * **Покинуть чат:** Позволяет покинуть групповой чат или отписаться от канала.
  * **Удалить чат:** Позволяет полностью удалить чат (доступно только для администраторов/владельцев или для приватных чатов для любого из участников).

### Выход из аккаунта

Нажмите на кнопку с вашим именем пользователя в правом верхнем углу (на кнопке "Профиль") и выберите "Выйти". Вы будете возвращены к экрану входа.

## 6\. Структура проекта

  * `main.py`: Основной файл приложения. Содержит логику GUI, взаимодействие с API backend'а через класс `ApiClient`, а также диалоги для входа, регистрации и создания чатов.
  * `ApiClient` класс: Инкапсулирует все HTTP-запросы к API backend'а, упрощая взаимодействие с ним.
  * `LoginDialog` класс: Реализует диалоговое окно для входа и регистрации пользователя, а также настройки сервера.
  * `MainWindow` класс: Основное окно мессенджера, где происходит отображение чатов, сообщений и взаимодействие с ними.

## 7\. API Клиент

Класс `ApiClient` в `main.py` отвечает за все коммуникации с вашим Flask backend. Он использует библиотеку `requests` для выполнения HTTP-запросов.

Ключевые особенности:

  * **Управление сессией:** Использует `requests.Session()` для поддержания сессии (включая куки аутентификации) между запросами, что критично для поддержания входа в систему.
  * **Динамический `BASE_URL`:** `BASE_URL` теперь устанавливается через метод `set_base_url`, что позволяет пользователю указывать адрес и порт backend сервера при запуске клиента.
  * **Методы для каждого эндпоинта:** Имеет отдельные методы для `register`, `login`, `logout`, `get_profile`, `update_profile`, `change_password`, `delete_account`, `search_users`, `create_private_chat`, `create_group_chat`, `create_channel`, `get_chats`, `get_chat_details`, `update_chat`, `delete_chat`, `add_group_member`, `update_group_member_role`, `remove_group_member`, `subscribe_to_channel`, `unsubscribe_from_channel`, `send_text_message`, `send_file_message`, `get_messages`, `delete_message`. Каждый метод соответствует определенному эндпоинту backend API.
  * **Обработка ответов:** Методы возвращают объекты `requests.Response`, что позволяет UI-слою обрабатывать статусы и данные ответов.

## 8\. Обработка ошибок

Клиентское приложение обрабатывает ошибки, возвращаемые backend API, и отображает их пользователю через `QMessageBox`. Если API возвращает статус ошибки (например, 4xx или 5xx), клиент пытается извлечь сообщение об ошибке из JSON-ответа (`response.json().get('error', 'Default Error Message')`) и показывает его. Это обеспечивает понятную обратную связь пользователю в случае проблем с API.

-----